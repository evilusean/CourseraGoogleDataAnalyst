library(tidyverse)  #helps wrangle data
library(lubridate)  #helps wrangle date attributes
library(ggplot2)  #helps visualize data

library(readxl)
library(dplyr)
getwd() #displays your working directory
#setwd("I:\Coding\CourseraGoogleDataAnalyst\CaseStudy1\CS1XLS") 
#set working directory manually, at top go to 'Session' -> 'Set Working Directory'
Df <- read_xlsx("202104-202204Consolidateddivvy-tripdata.xlsx")
#created dataframe using read_xlsx with aggregated dataset
str(Df)
#displays STRucture of dataframe
Nrow(Df)
#212979 rows
dim(Df)
#DIMensions=212979 rows by 15 columns

#Df <- Df %>% 
#+     select(-c(start_lat, start_lng, end_lat, end_lng))
#Df <- Df %>% select(Df, -c(start_lat, start_lng, end_lat, end_lng))
#used a pipe to reduce the Dataframe and remove unneeded data to make it less 'busy'
#-c argument removes from dataframe
Df <- subset (Df, select = -c(start_lat,start_lng, end_lat, end_lng))
#used subset for final analysis

colnames(Df)
#check columns; formerly 15 down to 11
Df <- drop_na(Df)
#drop NA rows, down to 150,874 rows, 11 columns
head(Df)
#Check top 6 rows
summary(Df)
#summary of data

all_trips <-  Df %>% 
  mutate(member_casual = recode(member_casual
                                ,"Subscriber" = "member"
                                ,"Customer" = "casual"))
#renamed Df to all_trips to be more aligned with template
#changed names of customer/subscriber to member/casual respectively

# Check to make sure the proper number of observations were reassigned
table(all_trips$member_casual)

# Add columns that list the date, month, day, and year of each ride
# This will allow us to aggregate ride data for each month, day, or year ... before completing these operations we could only aggregate at the ride level
# https://www.statmethods.net/input/dates.html more on date formats in R found at that link
all_trips$date <- as.Date(all_trips$started_at) #The default format is yyyy-mm-dd
all_trips$month <- format(as.Date(all_trips$date), "%m")
all_trips$day <- format(as.Date(all_trips$date), "%d")
all_trips$year <- format(as.Date(all_trips$date), "%Y")
all_trips$day_of_week <- format(as.Date(all_trips$date), "%A")
#back up to 15 columns added month/day/year/date columns for easier calculations

#Error in as.POSIXlt.character(x, tz, ...) : 
#  character string is not in a standard unambiguous format
#need to typecast or mutate using lubridate

